# ูุธุงู ุฅุฏุงุฑุฉ ุงููููุงุช ูุงููุณุชูุฏุงุช ๐
# File Management System

## ูุธุฑุฉ ุนุงูุฉ - Overview

ุชู ุฅุถุงูุฉ ูุธุงู ุดุงูู ูุฅุฏุงุฑุฉ ุงููููุงุช ูุงููุณุชูุฏุงุช ูู ูุธุงู ุฅุฏุงุฑุฉ ุงูููุงู. ูุณูุญ ูุฐุง ุงููุธุงู ูููุญุงูููู ุจุฑูุน ุงููููุงุช ูุงููุณุชูุฏุงุช ูุงูุตูุฑ ุงููุฑุชุจุทุฉ ุจูู ูููุฉ ูุน ูุฑุถ ูููุฏ ุนูู ุฃุณุงุณ ุฏูุฑ ุงููุณุชุฎุฏู.

A comprehensive file management system has been added to the task management system. This system allows lawyers to upload files, documents, and images associated with each task with role-based restrictions enforced.

---

## ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ - Key Features

### 1. ุฑูุน ุงููููุงุช - File Upload
- โ ุฑูุน ูุชุนุฏุฏ ุงููููุงุช - Multi-file upload
- โ ูุงุฌูุฉ ุงูุณุญุจ ูุงูุฅููุงุช - Drag & drop interface
- โ ุงุฎุชูุงุฑ ุงููููุงุช ูุฏูููุง - Manual file selection
- โ ูุนุงููุฉ ุงููููุงุช ูุจู ุงูุฑูุน - File preview before upload
- โ ุชุญูู ูู ุงูุญุฌู ูุงูููุน - File type and size validation

### 2. ุฅุฏุงุฑุฉ ุงููููุงุช - File Management
- โ ุนุฑุถ ุฌููุน ูููุงุช ุงููููุฉ - View all task files
- โ ุชูุฒูู ุงููููุงุช - Download files with original names
- โ ุญุฐู ุงููููุงุช - Delete files with confirmation
- โ ุนุฑุถ ูุนูููุงุช ุงูููู - Display file metadata (size, date, uploader)
- โ ุฑููุฒ ุงููููุงุช - File category icons

### 3. ูููุฏ ูุงุฆูุฉ ุนูู ุงูุฃุฏูุงุฑ - Role-Based Restrictions

#### ุงูุฅุฏุงุฑุฉ - Admin
```
ุงูุญุฏ ุงูุฃูุตู ูููููุงุช: 50 ููู
ุงูุฃููุงุน ุงููุณููุญุฉ: ุฌููุน ุงูุฃููุงุน (ุตูุฑุ ูุณุชูุฏุงุชุ ุฃุฑุดููุงุช)
ุญุฐู ูููุงุช ุงูุขุฎุฑูู: ูุนู
ุนุฑุถ ุฌููุน ุงููููุงุช: ูุนู
```

#### ุงููุญุงูู - Lawyer
```
ุงูุญุฏ ุงูุฃูุตู ูููููุงุช: 30 ููู
ุงูุฃููุงุน ุงููุณููุญุฉ: ุฌููุน ุงูุฃููุงุน (ุตูุฑุ ูุณุชูุฏุงุชุ ุฃุฑุดููุงุช)
ุญุฐู ูููุงุช ุงูุขุฎุฑูู: ูุง
ุนุฑุถ ุฌููุน ุงููููุงุช: ูุง (ููุท ุงููููุงุช ุงูุชู ุฑูุนูุง ูุงููููุงุช ุงููุดุชุฑูุฉ)
```

#### ุฑุฆูุณ ุงููุณู - Department Head
```
ุงูุญุฏ ุงูุฃูุตู ูููููุงุช: 40 ููู
ุงูุฃููุงุน ุงููุณููุญุฉ: ุฌููุน ุงูุฃููุงุน (ุตูุฑุ ูุณุชูุฏุงุชุ ุฃุฑุดููุงุช)
ุญุฐู ูููุงุช ุงูุขุฎุฑูู: ูุนู
ุนุฑุถ ุฌููุน ุงููููุงุช: ูุนู
```

### 4. ุฃููุงุน ุงููููุงุช ุงููุฏุนููุฉ - Supported File Types

#### ุงูุตูุฑ - Images
- `JPG` / `JPEG`
- `PNG`
- `GIF`
- `WebP`

#### ุงููุณุชูุฏุงุช - Documents
- `PDF`
- `DOC` / `DOCX`
- `XLS` / `XLSX`
- `TXT`

#### ุงูุฃุฑุดููุงุช - Archives
- `ZIP`
- `RAR`
- `7Z`

### 5. ุญุฏูุฏ ุงููููุงุช - File Limits
- **ุญุฌู ุงูููู ุงููุงุญุฏ:** 50 MB
- **ุนุฏุฏ ุงููููุงุช ููู ุฑูุน:** 20 ููู ุจุญุฏ ุฃูุตู
- **ุชูุจูู ุงูุญุตุฉ:** 80% ูู ุงูุญุฏ ุงูุฃูุตู

---

## ุงูุจููุฉ ุงูุชูููุฉ - Technical Architecture

### Backend

#### ุงูููู: `backend/routes/files.js`
ูุญุชูู ุนูู ุฌููุน API endpoints ูุฅุฏุงุฑุฉ ุงููููุงุช:

**1. ุฑูุน ุงููููุงุช - Upload Files**
```
POST /api/files/:taskId/upload
Headers: Authorization: Bearer {token}
Content-Type: multipart/form-data
Body: files (multiple files)

Response:
{
  "success": true,
  "message": "ุชู ุฑูุน 2 ููู(ุงุช) ุจูุฌุงุญ",
  "files": [
    {
      "id": "abc123",
      "filename": "contract.pdf",
      "size": "2 MB",
      "category": "document",
      "uploadedAt": "2024-01-20T10:30:00Z",
      "uploadedBy": "ูุญุงูู ุงูุนููุฏ"
    }
  ]
}
```

**2. ุงูุญุตูู ุนูู ุงููููุงุช - Get Task Files**
```
GET /api/files/:taskId/files
Headers: Authorization: Bearer {token}

Response:
{
  "success": true,
  "files": [...],
  "count": 2
}
```

**3. ุชูุฒูู ุงูููู - Download File**
```
GET /api/files/:taskId/download/:fileId
Headers: Authorization: Bearer {token}

Response: Binary file data with original filename
```

**4. ุญุฐู ุงูููู - Delete File**
```
DELETE /api/files/:taskId/files/:fileId
Headers: Authorization: Bearer {token}

Response:
{
  "success": true,
  "message": "ุชู ุญุฐู ุงูููู ุจูุฌุงุญ"
}
```

**5. ุงูุญุตูู ุนูู ูุชุทูุจุงุช ุงูุฏูุฑ - Get Role Requirements**
```
GET /api/files/requirements/:role
Headers: Authorization: Bearer {token}

Response:
{
  "success": true,
  "requirements": {
    "maxFiles": 30,
    "maxFileSize": 52428800,
    "allowedTypes": {
      "image": ["image/jpeg", "image/png", ...],
      "document": ["application/pdf", ...],
      "archive": ["application/zip", ...]
    }
  }
}
```

#### ูููู ุงูุชุฎุฒูู - Storage Structure
```
backend/
โโโ uploads/
    โโโ tasks/
        โโโ 1/
        โ   โโโ 1706520000000_contract.pdf
        โ   โโโ 1706520000100_agreement.docx
        โโโ 2/
        โ   โโโ 1706520000200_image.jpg
        โ   โโโ 1706520000300_archive.zip
        โโโ 3/
            โโโ 1706520000400_document.txt
```

#### ุชูุงูู ุงูุณุฌู ุงููุดุงุท - Activity Logging Integration
- ูุชู ุชุณุฌูู ูู ุนูููุฉ ุฑูุน: `file_uploaded`
- ูุชู ุชุณุฌูู ูู ุนูููุฉ ุญุฐู: `file_deleted`
- ุงููุนูููุงุช ุงููุณุฌูุฉ: ุงุณู ุงููููุ ุงูุญุฌูุ ุงูููุนุ ุงููุณุชุฎุฏูุ ุงูุชุงุฑูุฎ

### Frontend

#### ุงููููู: `frontend/src/components/TaskFilesManager.js`
ูููู React ูุชูุงูู ูุฅุฏุงุฑุฉ ุงููููุงุช:

**ุงูููุฒุงุช:**
- ูุงุฌูุฉ ุงูุณุญุจ ูุงูุฅููุงุช
- ุฑูุน ูุชุนุฏุฏ ุงููููุงุช
- ูุนุงููุฉ ุงููููุงุช ุงููุฎุชุงุฑุฉ
- ุนุฑุถ ูุชุทูุจุงุช ุงูุฏูุฑ
- ุชูุฒูู ุงููููุงุช
- ุญุฐู ุงููููุงุช ูุน ุชุฃููุฏ
- ุชูุจููุงุช ุงูุญุตุฉ (80%)
- ุฑุณุงุฆู ุงูุฎุทุฃ ูุงููุฌุงุญ

#### ุตูุญุฉ ุงูููุงู ุงููุญุฏุซุฉ - Updated Tasks Page

**ุงูุชุญุฏูุซุงุช:**
1. **ูููุฐุฌ ููุจ - Modal Dialog**: ุนุฑุถ ุชูุงุตูู ุงููููุฉ ูุน ูููู ุฅุฏุงุฑุฉ ุงููููุงุช
2. **ุญุงุฑุฉ ุงููููุงุช - File Count Badge**: ุนุฑุถ ุนุฏุฏ ุงููููุงุช ุนูู ุจุทุงูุฉ ุงููููุฉ
3. **ุฑุงุจุท ุงููููุฉ - Task Link**: ุงูููุฑ ุนูู ุงููููุฉ ููุชุญ ูููุฐุฌ ุงูุชูุงุตูู

**ุงููุชุบูุฑุงุช ุงูุญุงูุฉ ุงููุถุงูุฉ:**
```javascript
const [selectedTask, setSelectedTask] = useState(null);
const [showTaskDetails, setShowTaskDetails] = useState(false);
```

---

## ุณูุฑ ุงูุนูู - Workflow

### 1. ุนุฑุถ ูุงุฆูุฉ ุงูููุงู
```
ุชุตูุญ ุงูููุงู โ ุฑุคูุฉ ุดุงุฑุฉ ุงููููุงุช (ุฅู ูุฌุฏุช) โ ุงูููุฑ ุนูู ุงููููุฉ
```

### 2. ุฑูุน ุงููููุงุช
```
1. ูุชุญ ูููุฐุฌ ุชูุงุตูู ุงููููุฉ
2. ุงูุงูุชูุงู ุฅูู ูุณู "ุงููููุงุช ูุงููุณุชูุฏุงุช"
3. ุงุฎุชูุงุฑ ุงููููุงุช (ุณุญุจ ูุฅููุงุช ุฃู ุชุตูุญ)
4. ุงูููุฑ ุนูู "ุฑูุน"
5. ุงูุชุธุงุฑ ุงูุชุฃููุฏ
```

### 3. ุฅุฏุงุฑุฉ ุงููููุงุช
```
1. ุนุฑุถ ุงููููุงุช ุงููุฑููุนุฉ ูุน ุงููุนูููุงุช
2. ุชูุฒูู ุงูููู ุนูุฏ ุงูุญุงุฌุฉ
3. ุญุฐู ุงูููู ูุน ุงูุชุฃููุฏ
4. ุชุชุจุน ุงูุญุตุฉ ุงููุชุจููุฉ
```

---

## ุฃูุซูุฉ ุงูุงุณุชุฎุฏุงู - Usage Examples

### ุงุณุชูุฑุงุฏ ุงููููู - Import Component
```javascript
import TaskFilesManager from '../components/TaskFilesManager';

// ุงุณุชุฎุฏุงู - Usage
<TaskFilesManager taskId={task.id} />
```

### ุงูุญุตูู ุนูู ุญุฏ ุงููููุงุช - Get File Limit
```javascript
const fetchRequirements = async () => {
  const token = localStorage.getItem('token');
  const response = await axios.get(
    `http://localhost:5000/api/files/requirements/${user?.role}`,
    { headers: { Authorization: `Bearer ${token}` } }
  );
  console.log(response.data.requirements);
};
```

### ุฑูุน ุงููููุงุช - Upload Files
```javascript
const handleUpload = async (files) => {
  const formData = new FormData();
  Array.from(files).forEach(file => {
    formData.append('files', file);
  });

  const token = localStorage.getItem('token');
  const response = await axios.post(
    `http://localhost:5000/api/files/${taskId}/upload`,
    formData,
    {
      headers: {
        Authorization: `Bearer ${token}`,
        'Content-Type': 'multipart/form-data'
      }
    }
  );
  console.log('ุงููููุงุช ุงููุฑููุนุฉ:', response.data.files);
};
```

---

## ุฑุณุงุฆู ุงูุฎุทุฃ ุงูุดุงุฆุนุฉ - Common Error Messages

| ุงูุฎุทุฃ | ุงูุณุจุจ | ุงูุญู |
|------|------|------|
| ุชู ุชุฌุงูุฒ ุงูุญุฏ ุงูุฃูุตู ูููููุงุช | ุฑูุนุช ูููุงุช ุฃูุซุฑ ูู ุงููุณููุญ | ุงุญุฐู ุจุนุถ ุงููููุงุช ุงููุฏููุฉ |
| ููุน ุงูููู ุบูุฑ ูุฏุนูู | ุญุงููุช ุฑูุน ููู ุบูุฑ ูุฏุนูู | ุงุณุชุฎุฏู ุฃููุงุน ูููุงุช ูุฏุนููุฉ |
| ุญุฌู ุงูููู ูุจูุฑ ุฌุฏุงู | ุงูููู ุฃูุจุฑ ูู 50 MB | ููู ุญุฌู ุงูููู ุฃู ุถุบุทู |
| ูุง ุชูุฌุฏ ุตูุงุญูุงุช | ูุง ุชููู ุตูุงุญูุงุช ุงูุญุฐู | ุงุชุตู ุจุงูุฅุฏุงุฑุฉ |

---

## ูุนุงููุฑ ุงูุฃูุงู - Security Measures

### ุงูุชุญูู ูู ุงูุตูุงุญูุงุช - Permission Validation
```
โ ุงูุชุญูู ูู ููููุฉ ุงููููุฉ ูุจู ุงูุณูุงุญ ุจุงูุฑูุน
โ ุงูุชุญูู ูู ุฏูุฑ ุงููุณุชุฎุฏู ูุงูุญุฏูุฏ ุงูุฎุงุตุฉ ุจู
โ ุงูุชุญูู ูู ุตูุงุญูุงุช ุงูุญุฐู (ุงูุฑุงูุน ุฃู ุงูุฅุฏุงุฑุฉ ููุท)
```

### ุชุญูู ุงููููุงุช - File Validation
```
โ ูุญุต ููุน MIME ููููู
โ ูุญุต ุญุฌู ุงูููู
โ ููุน ูููุงุช ูุญุชููุฉ ุฎุทุฑุฉ (.exeุ .batุ ุฅูุฎ)
โ ุชูุธูู ุฃุณูุงุก ุงููููุงุช ูู ุงูุฃุญุฑู ุงูุฎุงุตุฉ
```

### ุญูุงูุฉ ุงูุจูุงูุงุช - Data Protection
```
โ ุชุฎุฒูู ุงููููุงุช ุฎุงุฑุฌ ุงููุณุงุฑ ุงูุนุงู
โ ุงุณุชุฎุฏุงู ูุนุฑูุงุช ุงููููุงุช ุงููุฑูุฏุฉ
โ ุชุณุฌูู ุฌููุน ุงูุนูููุงุช ูู ุงูุณุฌู ุงููุดุงุท
```

---

## ุงูุตูุงูุฉ - Maintenance

### ุชูุธูู ุงููููุงุช ุงููุญุฐููุฉ - Cleanup Deleted Files
```bash
# ูุฐุง ูุชู ุชููุงุฆูุงู ุนูุฏ ุญุฐู ุงูููู ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ
rm backend/uploads/tasks/{taskId}/{filename}
```

### ูุฑุงูุจุฉ ูุณุงุญุฉ ุงูุชุฎุฒูู - Monitor Storage
```bash
# ุญุณุงุจ ุญุฌู ูุฌูุฏ ุงููููุงุช
du -sh backend/uploads/
```

### ุฅุนุงุฏุฉ ุชุนููู ุงููููุงุช - Reset Files (Admin Only)
```javascript
// ุญุฐู ุฌููุน ูููุงุช ุงููููุฉ
const response = await tasksAPI.deleteAllFiles(taskId);
```

---

## ุงูุฎุทูุงุช ุงูุชุงููุฉ - Next Steps

- [ ] ุงุฎุชุจุงุฑ ุงูุฑูุน ูุน ุฃุฏูุงุฑ ูุฎุชููุฉ
- [ ] ุงุฎุชุจุงุฑ ุญุฏูุฏ ุงููููุงุช
- [ ] ุงุฎุชุจุงุฑ ุญุฐู ุงููููุงุช
- [ ] ุงุฎุชุจุงุฑ ุชูุฒูู ุงููููุงุช
- [ ] ุงูุชุญูู ูู ุงูุณุฌู ุงููุดุงุท
- [ ] ุงุฎุชุจุงุฑ ูุงุฌูุฉ ุงูุณุญุจ ูุงูุฅููุงุช
- [ ] ุงุฎุชุจุงุฑ ุงูุฃุฌูุฒุฉ ุงููุญูููุฉ
- [ ] ุฅุถุงูุฉ ูุนุงููุฉ ุตูุฑ ูุถููุฉ (ุฎูุงุฑ)

---

## ุงููุฑุงุฌุน - References

**ุงููููุงุช ุฐุงุช ุงูุตูุฉ:**
- Backend Route: `backend/routes/files.js`
- Frontend Component: `frontend/src/components/TaskFilesManager.js`
- Tasks Page: `frontend/src/pages/TasksPage.js`
- Server Config: `backend/server.js`

**ุงููุชุทูุจุงุช:**
- Express.js
- Multer v1.4.5-lts.1
- Axios (Frontend)
- React Icons

---

## ุงูุฏุนู - Support

ููุฃุณุฆูุฉ ุฃู ุงููุดุงููุ ูุฑุฌู ุงูุชุญูู ูู:
1. ุงูุณุฌู ุงููุดุงุท ููุนูููุงุช ุงูุฃุฎูุฑุฉ
2. ุงูุฃุฎุทุงุก ูู ูุญุฏุฉ ุชุญูู ุงููุชุตูุญ (F12)
3. ุฃุฎุทุงุก ุฎุงุฏู ุงูุชุทุจูู

---

**ุขุฎุฑ ุชุญุฏูุซ:** 2024-01-20
**ุงูุฅุตุฏุงุฑ:** 1.0.0
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุงุณุชุฎุฏุงู
